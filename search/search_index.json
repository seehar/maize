{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u7b80\u4ecb\u53ca\u5b89\u88c5","text":"<p>maize \u662f\u4e00\u4e2a\u57fa\u4e8e\u5f02\u6b65\uff0c\u8f7b\u91cf\u7ea7 Python \u722c\u866b\u6846\u67b6</p>"},{"location":"#_2","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>Python 3.10+</li> <li>Linux, Windows, macOS</li> </ul>"},{"location":"#_3","title":"\u5b89\u88c5","text":"pippoetry <pre><code>pip install maize\n</code></pre> <pre><code>poetry add maize\n</code></pre>"},{"location":"quick_start/","title":"\u5feb\u901f\u4e0a\u624b","text":""},{"location":"quick_start/#spider","title":"\u521b\u5efa spider","text":"<p>\u4ee5\u767e\u5ea6\u722c\u866b\u4e3a\u4f8b\uff0c\u5b9e\u73b0\u4e00\u4e2a\u6700\u5c0f\u7684\u722c\u866b\u9879\u76ee</p> <pre><code>import asyncio\nfrom maize import CrawlerProcess, Spider\n\n\nclass BaiduSpider(Spider):\n    start_urls = [\"http://www.baidu.com\"]\n\n    async def parse(self, response):\n        print(f\"parse: {response}\")\n\n\nasync def run():\n    process = CrawlerProcess()\n    await process.crawl(BaiduSpider)\n    await process.start()\n\n\nif __name__ == '__main__':\n    asyncio.run(run())\n</code></pre>"},{"location":"quick_start/#_2","title":"\u4e0b\u53d1\u65b0\u4efb\u52a1","text":"<p><code>parse</code> \u4e2d\u652f\u6301\u4e0b\u53d1\u65b0\u4efb\u52a1\uff0c\u53ea\u9700\u8981 <code>yield Request</code> \u5373\u53ef\u3002\u793a\u4f8b\u5982\u4e0b</p> <pre><code>from maize import Request\n\nasync def parse(self, response):\n    yield Request(url=\"url\")  # \u4e0d\u6307\u5b9a callback\uff0c\u4efb\u52a1\u4f1a\u9ed8\u8ba4\u8c03\u5ea6\u5230 parse \u4e0a\n    yield Request(url=\"url\", callback=self.parse_page)  # \u6307\u5b9a callback\uff0c\u4efb\u52a1\u7531 callback \u6307\u5b9a\u7684\u51fd\u6570\u89e3\u6790\u3002\u6ce8\u610f\uff0c\u9700\u8981\u5f02\u6b65\u51fd\u6570\n</code></pre>"},{"location":"quick_start/#_3","title":"\u722c\u866b\u914d\u7f6e","text":"<p>\u722c\u866b\u914d\u7f6e\u652f\u6301\u81ea\u5b9a\u4e49\u914d\u7f6e\u6216\u5f15\u5165\u914d\u7f6e\u6587\u4ef6setting.py\u7684\u65b9\u5f0f\u3002 \u914d\u7f6e\u6587\u4ef6\uff1a\u5728\u5de5\u4f5c\u533a\u95f4\u7684\u6839\u76ee\u5f55\u4e0b\u5f15\u5165setting.py\uff0c\u5177\u4f53\u53c2\u8003\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6</p> <pre><code>spider\n    baidu_spider.py\n    ...\nsettings.py  # \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u914d\u7f6e\u6587\u4ef6\u9700\u4e0e run.py \u540c\u7ea7\u522b\nrun.py\n</code></pre> <p>\u81ea\u5b9a\u4e49\u914d\u7f6e\uff1a\u4f7f\u7528\u7c7b\u53d8\u91cf <code>custom_settings</code></p> <pre><code>class BaiduSpider(Spider):\n    custom_settings = {  # \u81ea\u5b9a\u4e49\u914d\u7f6e\n        \"CONCURRENCY\": 1,  # \u5e76\u53d1\u6570\n    }\n</code></pre> <p>\u914d\u7f6e\u4f18\u5148\u7ea7\uff1a\u81ea\u5b9a\u4e49\u914d\u7f6e &gt; \u914d\u7f6e\u6587\u4ef6\uff0c\u5373\u81ea\u5b9a\u4e49\u914d\u7f6e\u4f1a\u8986\u76d6\u914d\u7f6e\u6587\u4ef6\u91cc\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u4e0d\u8fc7\u81ea\u5b9a\u4e49\u914d\u7f6e\u53ea\u5bf9\u81ea\u5df1\u6709\u6548\uff0c\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u662f\u591a\u4e2a\u722c\u866b\u516c\u7528\u7684</p>"},{"location":"quick_start/#_4","title":"\u52a0\u5feb\u91c7\u96c6","text":"<p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5e76\u53d1\u6570 <code>CONCURRENCY</code> \u5373\u53ef</p>"},{"location":"quick_start/#_5","title":"\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u5668","text":"<p>\u5185\u7f6e\u57fa\u4e8e <code>aiohttp</code> \u548c <code>httpx</code> \u7684\u4e24\u79cd\u4e0b\u8f7d\u5668\u3002\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4fee\u6539</p> <pre><code>DOWNLOADER = \"maize.AioHttpDownloader\"  # \u57fa\u4e8e aiohttp \u7684\u4e0b\u8f7d\u5668\nDOWNLOADER = \"maize.HTTPXDownloader\"    # \u57fa\u4e8e httpx \u7684\u4e0b\u8f7d\u5668\n</code></pre> <p>\u4e0b\u8f7d\u5668\u662f\u63d2\u62d4\u5f0f\u7684\u8bbe\u8ba1\uff0c\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u66ff\u6362\u4e3a\u81ea\u5b9a\u4e49\u7684\u4e0b\u8f7d\u5668\u3002\u7ee7\u627f <code>BaseDownloader</code> \u5b9e\u73b0 <code>download</code> \u548c <code>structure_response</code> \u4e24\u4e2a\u65b9\u6cd5\u3002 \u5c06\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 <code>DOWNLOADER</code> \u7684\u8def\u5f84\u66ff\u6362\u4e3a\u60a8\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u5668\u7684\u8def\u5f84\u3002\u793a\u4f8b\uff1a</p> <pre><code>import typing\n\nfrom maize import BaseDownloader, Request, Response\n\n\nclass CustomDownloader(BaseDownloader):\n\n    async def download(self, request: Request) -&gt; typing.Optional[Response]:\n        pass\n\n    @staticmethod\n    def structure_response(request: Request, response: typing.Any, body: bytes) -&gt; Response:\n        pass\n</code></pre> <p>\u60a8\u4e5f\u53ef\u4ee5\u4e0d\u7ee7\u627f <code>BaseDownloader</code>\uff0c\u9700\u8981\u5728\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u5668\u4e2d\u5b9e\u73b0\u8fd9\u51e0\u4e2a\u65b9\u6cd5\uff1a<code>fetch</code>, <code>download</code>, <code>create_instance</code>, <code>close</code>, <code>idle</code>\u3002 \u4f46\u662f\u6211\u4eec\u5efa\u8bae\u60a8\u7ee7\u627f <code>BaeDownloader</code> \u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u5668</p>"},{"location":"quick_start/#_6","title":"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6a21\u5757","text":"<p><code>maize</code> \u7684\u65e5\u5fd7\u9ed8\u8ba4\u4f7f\u7528 <code>Python</code> \u81ea\u5e26\u7684 <code>logging</code> \u6a21\u5757\u3002 \u4f46\u662f\u60a8\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u66ff\u6362\u4e3a\u60a8\u60f3\u7528\u7684\u65e5\u5fd7\u6a21\u5757\uff0c\u6bd4\u5982 <code>loguru</code>\u3002\u793a\u4f8b\uff1a</p> <pre><code>import logging\nimport sys\n\nfrom loguru import logger as loguru_logger\n\n\nclass InterceptHandler(logging.Handler):\n    def __init__(self):\n        super().__init__()\n        self.logger = loguru_logger\n        self.logger.remove()\n        self.logger.add(\n            sys.stdout,\n            level=\"DEBUG\",\n            format=\"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | \"  # \u989c\u8272&gt;\u65f6\u95f4\n            \"{process.name} | \"  # \u8fdb\u7a0b\u540d\n            \"{thread.name} | \"  # \u8fdb\u7a0b\u540d\n            \"&lt;cyan&gt;{module}&lt;/cyan&gt;.&lt;cyan&gt;{function}&lt;/cyan&gt;\"  # \u6a21\u5757\u540d.\u65b9\u6cd5\u540d\n            \":&lt;cyan&gt;{line}&lt;/cyan&gt; | \"  # \u884c\u53f7\n            \"&lt;level&gt;{level}&lt;/level&gt;: \"  # \u7b49\u7ea7\n            \"&lt;level&gt;{message}&lt;/level&gt;\",  # \u65e5\u5fd7\u5185\u5bb9\n        )\n\n    def emit(self, record: logging.LogRecord):\n        logger_opt = self.logger.opt(depth=7, exception=record.exc_info)\n        logger_opt.log(record.levelno, record.getMessage())\n</code></pre> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u60a8\u7684\u65e5\u5fd7\u6a21\u5757</p> <pre><code>LOGGER_HANDLER = \"the.logger.path.InterceptHandler\"  # \u8bf7\u66ff\u6362\u4e3a\u5b9e\u9645\u8def\u5f84\n</code></pre>"},{"location":"features/item/","title":"Item","text":"<p>\u89e3\u6790\u54cd\u5e94\u540e\uff0c\u9700\u8981\u8fd4\u56de <code>Item</code> \u7c7b\u578b\u7684\u6570\u636e\uff0c\u89e6\u53d1\u6570\u636e\u81ea\u52a8\u5165\u5e93\u3002 \u81ea\u5b9a\u4e49\u7684 <code>Item</code> \u9700\u8981\u7ee7\u627f <code>maize</code> \u7684 <code>Item</code> \u7c7b\uff0c\u5b57\u6bb5\u5b9a\u4e49\u4e3a <code>Field</code>\u3002\u793a\u4f8b\uff1a</p> <pre><code>from maize import Field, Item\n\n\nclass BaiduItem(Item):\n    #  __table_name__ = \"table_name\"  # \u8868\u540d\uff0c\u81ea\u52a8\u5165\u5e93\u65f6\u5fc5\u987b\u8bbe\u7f6e\n    url = Field()\n    title = Field()\n</code></pre> <p>\u5728 <code>Spider</code> \u7684 <code>parse</code> \u4e2d</p> <pre><code>from maize import Spider\n\n\nclass BaiduSpider(Spider):\n    start_urls = [\"http://www.baidu.com\"]\n\n    async def parse(self, response):\n        # \u89e3\u6790\u6216\u5904\u7406 response\n        item = BaiduItem()\n        item[\"url\"] = \"https://www.baidu.com\"\n        item[\"title\"] = \"\u767e\u5ea6\u4e00\u4e0b\"\n        yield item\n</code></pre>"},{"location":"features/log/","title":"\u65e5\u5fd7\u914d\u7f6e\u53ca\u4f7f\u7528","text":"<p><code>maize</code> \u7684\u65e5\u5fd7\u9ed8\u8ba4\u4f7f\u7528 <code>Python</code> \u81ea\u5e26\u7684 <code>logging</code> \u6a21\u5757\u3002 \u4f46\u662f\u60a8\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u66ff\u6362\u4e3a\u60a8\u60f3\u7528\u7684\u65e5\u5fd7\u6a21\u5757\uff0c\u6bd4\u5982 <code>loguru</code>\u3002\u793a\u4f8b\uff1a</p> <pre><code>import logging\nimport sys\n\nfrom loguru import logger as loguru_logger\n\n\nclass InterceptHandler(logging.Handler):\n    def __init__(self):\n        super().__init__()\n        self.logger = loguru_logger\n        self.logger.remove()\n        self.logger.add(\n            sys.stdout,\n            level=\"DEBUG\",  # \u8bf7\u6ce8\u610f\uff0c\u6b64\u5904\u7684\u65e5\u5fd7\u7ea7\u522b\u4f1a\u8986\u76d6\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u65e5\u5fd7\u7ea7\u522b\n            format=\"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | \"  # \u65f6\u95f4\n            \"{process.name} | \"  # \u8fdb\u7a0b\u540d\n            \"{thread.name} | \"  # \u8fdb\u7a0b\u540d\n            \"&lt;cyan&gt;{module}&lt;/cyan&gt;.&lt;cyan&gt;{function}&lt;/cyan&gt;\"  # \u6a21\u5757\u540d.\u65b9\u6cd5\u540d\n            \":&lt;cyan&gt;{line}&lt;/cyan&gt; | \"  # \u884c\u53f7\n            \"&lt;level&gt;{level}&lt;/level&gt;: \"  # \u7b49\u7ea7\n            \"&lt;level&gt;{message}&lt;/level&gt;\",  # \u65e5\u5fd7\u5185\u5bb9\n        )\n\n    def emit(self, record: logging.LogRecord):\n        logger_opt = self.logger.opt(depth=7, exception=record.exc_info)\n        logger_opt.log(record.levelno, record.getMessage())\n</code></pre> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u60a8\u7684\u65e5\u5fd7\u6a21\u5757</p> <pre><code>LOGGER_HANDLER = \"the.logger.path.InterceptHandler\"  # \u8bf7\u66ff\u6362\u4e3a\u5b9e\u9645\u8def\u5f84\n</code></pre>"},{"location":"features/mysql_util/","title":"MysqlUtil","text":"<p><code>MysqlUtil</code> \u662f\u4e00\u4e2a\u57fa\u4e8e <code>aiomysql</code> \u7684\u5f02\u6b65 MySQL \u5de5\u5177\u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u6570\u636e\u5e93\u64cd\u4f5c\u65b9\u6cd5\uff0c\u5185\u7f6e\u8fde\u63a5\u6c60\uff0c\u652f\u6301\u591a\u7ebf\u7a0b\u5e76\u53d1\u64cd\u4f5c\u3002</p>"},{"location":"features/mysql_util/#_1","title":"\u5355\u4f8b\u6a21\u5f0f","text":"<p><code>MysqlSingletonUtil</code> \u7c7b\u5b9e\u73b0\u4e86\u5355\u4f8b\u6a21\u5f0f\uff0c\u4f7f\u7528\u65b9\u6cd5\u4e0e <code>MysqlUtil</code> \u76f8\u540c\u3002</p>"},{"location":"features/mysql_util/#_2","title":"\u53c2\u6570\u8be6\u89e3","text":"\u53c2\u6570\u540d \u7c7b\u578b \u662f\u5426\u5fc5\u987b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>host</code> <code>str</code> \u662f \u6570\u636e\u5e93\u5730\u5740 <code>port</code> <code>int</code> \u5426 3306 \u6570\u636e\u5e93\u7aef\u53e3 <code>user</code> <code>str</code> \u5426 root \u6570\u636e\u5e93\u7528\u6237\u540d <code>password</code> <code>str</code> \u662f \u6570\u636e\u5e93\u5bc6\u7801 <code>db</code> <code>str</code> \u662f \u6570\u636e\u5e93\u540d <code>minsize</code> <code>int</code> \u5426 1 \u8fde\u63a5\u6c60\u6700\u5c0f\u8fde\u63a5\u6570 <code>maxsize</code> <code>int</code> \u5426 10 \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570 <code>echo</code> <code>bool</code> \u5426 <code>False</code> <code>pool_recycle</code> <code>int</code> \u5426 <code>-1</code>"},{"location":"features/mysql_util/#open","title":"open","text":"<p>\u5f00\u542f\u8fde\u63a5\u6c60\uff0c\u5982\u679c\u5df2\u7ecf\u5f00\u542f\u5219\u4e0d\u4f1a\u91cd\u590d\u5f00\u542f</p>"},{"location":"features/mysql_util/#close","title":"close","text":"<p>\u5173\u95ed\u8fde\u63a5\u6c60\uff0c\u5982\u679c\u5df2\u7ecf\u5173\u95ed\u5219\u4e0d\u4f1a\u91cd\u590d\u5173\u95ed</p>"},{"location":"features/mysql_util/#fetchone","title":"fetchone","text":"<pre><code>async def fetchone(\n    self, sql: str, args: typing.Optional[list | set] = None\n) -&gt; dict[str, typing.Any]:\n    \"\"\"\n    \u67e5\u8be2\u5355\u6761\u6570\u636e\n    :param sql: sql \u8bed\u53e5\n    :param args: list \u6216 set \u7c7b\u578b\u7684\u53c2\u6570\n    :return: \u5355\u6761\u7ed3\u679c\u96c6\n    \"\"\"\n</code></pre>"},{"location":"features/mysql_util/#fetchall","title":"fetchall","text":"<pre><code>async def fetchall(\n    self, sql: str, args: typing.Optional[list | set] = None\n) -&gt; list[dict[str, typing.Any]]:\n    \"\"\"\n    \u67e5\u8be2\u591a\u6761\u6570\u636e\n    :param sql: sql \u8bed\u53e5\n    :param args: list \u6216 set \u7c7b\u578b\u7684\u53c2\u6570\n    :return: \u591a\u6761\u7ed3\u679c\u96c6\n    \"\"\"\n</code></pre>"},{"location":"features/mysql_util/#execute","title":"execute","text":"<pre><code>async def execute(self, sql: str, args: typing.Optional[list | set] = None):\n    \"\"\"\n    \u6267\u884c\u589e\u5220\u6539\u64cd\u4f5c\n    :param sql: sql \u8bed\u53e5\n    :param args: list \u6216 set \u7c7b\u578b\u7684\u53c2\u6570\n    :return: \u65e0\u8fd4\u56de\n    \"\"\"\n</code></pre>"},{"location":"features/mysql_util/#executemany","title":"executemany","text":"<pre><code>async def executemany(self, sql: str, args: typing.Optional[list | set] = None):\n    \"\"\"\n    \u6279\u91cf\u6267\u884c\u589e\u5220\u6539\u64cd\u4f5c\n    :param sql: sql \u8bed\u53e5\n    :param args: ist \u6216 set \u7c7b\u578b\u7684\u53c2\u6570\n    :return: \u65e0\u8fd4\u56de\n    \"\"\"\n</code></pre>"},{"location":"features/pipeline/","title":"\u6570\u636e\u7ba1\u9053 - Pipeline","text":"<p>Pipeline\u662f\u6570\u636e\u5165\u5e93\u65f6\u6d41\u7ecf\u7684\u7ba1\u9053\uff0c\u7528\u6237\u53ef\u81ea\u5b9a\u4e49\uff0c\u4ee5\u4fbf\u5bf9\u63a5\u5176\u4ed6\u6570\u636e\u5e93\u3002 \u6846\u67b6\u5df2\u5185\u7f6e\u57fa\u4e8e <code>aiomysql</code> \u5c01\u88c5\u7684 <code>mysql</code> \u7ba1\u9053\uff0c\u5176\u4ed6\u7ba1\u9053\u7ee7\u627f <code>BasePipeline</code> \u7c7b\u81ea\u884c\u5b9e\u73b0\u3002</p>"},{"location":"features/pipeline/#_1","title":"\u4f7f\u7528\u65b9\u5f0f","text":"<p>\u6ce8\uff1a<code>item</code> \u4f1a\u88ab\u805a\u5408\u6210\u591a\u6761\u4e00\u8d77\u6d41\u7ecf <code>pipeline</code>\uff0c\u65b9\u4fbf\u6279\u91cf\u5165\u5e93\u3002 \u6846\u67b6\u5185\u7f6e\u7684 <code>MysqlPipeline</code> \u4f1a\u81ea\u52a8\u5165\u5e93\uff0c\u65e0\u9700\u7528\u6237\u81ea\u884c\u8c03\u7528 <code>process_item</code> \u65b9\u6cd5\u3002</p>"},{"location":"features/pipeline/#pipeline","title":"\u81ea\u5b9a\u4e49 <code>Pipeline</code>","text":"<pre><code>from maize import BasePipeline\n\n\nclass CustomPipeline(BasePipeline):\n\n    async def open(self):\n        \"\"\"\n        \u7ba1\u9053\u521d\u59cb\u5316\u65f6\u8c03\u7528\uff0c\u9700\u8981\u521d\u59cb\u5316\u7684\u5f02\u6b65\u65b9\u6cd5\u8bf7\u5728\u6b64\u5b9e\u73b0\n        :return: \n        \"\"\"\n\n    async def close(self):\n        \"\"\"\n        \u7ba1\u9053\u5173\u95ed\u65f6\u8c03\u7528\uff0c\u9700\u8981\u5173\u95ed\u7684\u5f02\u6b65\u65b9\u6cd5\u8bf7\u5728\u6b64\u5b9e\u73b0\n        :return: \n        \"\"\"\n\n    async def process_item(self, items: list[\"Item\"]):\n        \"\"\"\n        \u5904\u7406\u6570\u636e\uff0c\u9700\u8981\u5904\u7406\u6570\u636e\u7684\u65b9\u6cd5\u8bf7\u5728\u6b64\u5b9e\u73b0\u3002\n        \u4e3a\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u8bf7\u4f7f\u7528\u5f02\u6b65\u65b9\u6cd5\u3002\n        :param items: \n        :return: \n        \"\"\"\n</code></pre>"},{"location":"features/pipeline/#_2","title":"\u6570\u636e\u81ea\u52a8\u5165\u5e93","text":"<p>\u9700\u8981\u5728 <code>Item</code> \u4e2d\u589e\u52a0 <code>__table_name__</code> \u5b57\u6bb5\uff0c\u6b64\u5b57\u6bb5\u5bf9\u5e94\u6570\u636e\u5e93\u8868\u540d\uff0c\u6846\u67b6\u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u5165\u5e93\u3002</p> <pre><code>from maize import Item, Field\n\n\nclass CustomItem(Item):\n    __table_name__ = \"custom_item\"\n    name = Field()  # \u5bf9\u5e94\u6570\u636e\u5e93\u8868\u7684\u5b57\u6bb5\n    # ...\n</code></pre>"},{"location":"features/pipeline/#pipeline_1","title":"\u6ce8\u518c <code>Pipeline</code>","text":"<p>\u53ef\u4ee5\u5728 <code>settings.py</code> \u4e2d\u8fdb\u884c\u6ce8\u518c\uff0c\u4e5f\u53ef\u4ee5\u5728 <code>spider.py</code> \u4e2d\u8fdb\u884c\u6ce8\u518c\u3002 \u5c06\u7f16\u5199\u597d\u7684 <code>pipeline</code> \u914d\u7f6e\u8fdb\u6765\uff0c\u503c\u4e3a\u7c7b\u7684\u6a21\u5757\u8def\u5f84\uff0c\u9700\u8981\u6307\u5b9a\u5230\u5177\u4f53\u7684\u7c7b\u540d</p> <pre><code># \u6570\u636e\u7ba1\u9053\uff0c\u652f\u6301\u591a\u4e2a\u6570\u636e\u7ba1\u9053\n# BasePipeline: \u9ed8\u8ba4\u6570\u636e\u7ba1\u9053\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\n# MysqlPipeline: \u96c6\u6210 aiomysql \u7684\u6570\u636e\u7ba1\u9053\uff0c\u81ea\u52a8\u5165\u5e93 mysql \u6570\u636e\u5e93\nITEM_PIPELINES = [\"maize.BasePipeline\"]\n</code></pre>"},{"location":"features/request/","title":"\u8bf7\u6c42 - Request","text":""},{"location":"features/request/#_1","title":"\u7b80\u4ecb","text":"<p><code>Request</code> \u4e3a <code>maize</code> \u4e3a\u4e86\u9002\u914d\u4e0d\u540c\u4e0b\u8f7d\u5668\u5bf9\u8bf7\u6c42\u8fdb\u884c\u7684\u5c01\u88c5\u3002 \u53ef\u4ee5\u5728\u722c\u866b\u7684 <code>start_requests</code>, <code>parse</code> \u8fd4\u56de <code>Request</code>\uff0c \u5f15\u64ce\u4f1a\u5c06\u8bf7\u6c42\u5165\u961f\uff0c\u8fdb\u884c\u8bf7\u6c42\u4e0b\u8f7d\u3002</p>"},{"location":"features/request/#_2","title":"\u53c2\u6570\u8be6\u89e3","text":"<p>\u8bf7\u6ce8\u610f\uff0c<code>Request</code> \u4e2d\u53c2\u6570\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u53c2\u6570\u3002\u6bd4\u5982\uff1a<code>proxy</code></p> \u53c2\u6570\u540d \u7c7b\u578b \u662f\u5426\u5fc5\u987b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>url</code> <code>str</code> \u662f \u8bf7\u6c42\u7684 <code>url</code> <code>method</code> <code>str</code> \u5426 <code>GET</code> \u8bf7\u6c42\u65b9\u5f0f\uff0c\u5982 <code>GET</code>, <code>POST</code>, <code>PUT</code> <code>callback</code> <code>Callable</code> \u5426 <code>parse</code> \u81ea\u5b9a\u4e49\u7684\u89e3\u6790\u51fd\u6570\uff0c\u9ed8\u8ba4\u4e3a <code>parse</code> <code>priority</code> <code>int</code> \u5426 <code>None</code> \u8bf7\u6c42\u4f18\u5148\u7ea7\uff0c\u9ed8\u8ba4\u4e3a <code>0</code> <code>headers</code> <code>dict</code> \u5426 <code>None</code> \u8bf7\u6c42\u5934 <code>params</code> <code>dict</code> \u5426 <code>None</code> \u8bf7\u6c42\u53c2\u6570 <code>data</code> <code>dict</code> \u5426 <code>None</code> \u8bf7\u6c42 <code>body</code> <code>cookies</code> <code>dict</code> \u5426 <code>None</code> \u8bf7\u6c42 <code>cookies</code> <code>proxy</code> <code>str</code> \u5426 <code>None</code> \u4ee3\u7406 <code>ip</code> <code>proxy_username</code> <code>str</code> \u5426 <code>None</code> \u4ee3\u7406 <code>ip</code> \u7528\u6237\u540d <code>proxy_password</code> <code>str</code> \u5426 <code>None</code> \u4ee3\u7406 <code>ip</code> \u5bc6\u7801 <code>encoding</code> <code>str</code> \u5426 <code>utf-8</code> \u7f16\u7801\uff0c\u5f53\u65e0\u6cd5\u89e3\u6790\u65f6\uff0c\u4f7f\u7528\u54cd\u5e94\u4e2d\u7684\u7f16\u7801\u5c1d\u8bd5\uff0c\u5982\u8fd8\u65e0\u6cd5\u89e3\u6790\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38 <code>meta</code> <code>dict</code> \u5426 <code>None</code> \u81ea\u5b9a\u4e49\u6570\u636e\uff0c\u4f1a\u4f20\u9012\u5230 <code>Response</code> \u4e2d\uff0c\u53ef\u5728 <code>Response</code> \u4e2d\u83b7\u53d6\u5230"},{"location":"features/request/#_3","title":"\u65b9\u6cd5\u8be6\u89e3","text":"<p>\u8bbe\u7f6e\u548c\u83b7\u53d6\u81ea\u5b9a\u4e49\u6570\u636e\uff0c\u53ef\u4ee5\u5728\u4e0b\u8f7d\u540e\u7684 <code>Response</code> \u4e2d\u83b7\u53d6\u5230</p> <pre><code>from maize import Request\n\n# \u8bbe\u7f6e meta\nrequest = Request(\"url\", meta={\"a\": 1})\n\n# \u83b7\u53d6 meta\nmeta = request.meta\n</code></pre>"},{"location":"features/response/","title":"\u54cd\u5e94 - Response","text":""},{"location":"features/response/#_1","title":"\u7b80\u4ecb","text":"<p><code>Response</code> \u4e3a <code>maize</code> \u4e3a\u9002\u914d\u4e0d\u540c\u4e0b\u8f7d\u5668\u5bf9\u54cd\u5e94\u8fdb\u884c\u7684\u5c01\u88c5\u3002 \u722c\u866b <code>parse</code> \u65b9\u6cd5\u4e2d\uff0c\u4f1a\u8fd4\u56de <code>Response</code> \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u60a8\u53ef\u4ee5\u5bf9\u54cd\u5e94\u8fdb\u884c\u5bf9\u5e94\u5bf9\u89e3\u6790\u548c\u5904\u7406</p>"},{"location":"features/response/#_2","title":"\u53c2\u6570\u8be6\u89e3","text":"\u53c2\u6570\u540d \u7c7b\u578b \u662f\u5426\u5fc5\u987b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>url</code> <code>str</code> \u662f \u8bf7\u6c42\u7684 <code>url</code> <code>headers</code> <code>dict</code> \u662f \u54cd\u5e94\u5934 <code>request</code> <code>Request</code> \u662f \u8bf7\u6c42 <code>Request</code> <code>body</code> <code>bytes</code> \u5426 <code>b\"\"</code> \u54cd\u5e94\u4f53 <code>status</code> <code>int</code> \u5426 <code>200</code> \u54cd\u5e94\u72b6\u6001\u7801\uff0c\u5982 <code>200</code>"},{"location":"features/response/#_3","title":"\u65b9\u6cd5\u8be6\u89e3","text":""},{"location":"features/response/#text","title":"<code>text</code>","text":"<p>\u8fd4\u56de\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u54cd\u5e94\u4f53</p>"},{"location":"features/response/#json","title":"<code>json</code>","text":"<p>\u57fa\u4e8e <code>ujson</code> \u8fd4\u56de\u683c\u5f0f\u5316\u7684 <code>json</code> \u7c7b\u578b\u7684\u6570\u636e</p>"},{"location":"features/response/#urljoin","title":"<code>urljoin</code>","text":"<p>\u57fa\u4e8e <code>urllib</code> \u7684 <code>urljoin</code> \u65b9\u6cd5\u62fc\u63a5 <code>url</code>\u3002 \u8fd4\u56de\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\u7684 <code>url</code>\uff0c\u65e0\u9700\u60a8\u5224\u65ad\u4f20\u5165\u7684\u65f6\u76f8\u5bf9\u8def\u5f84\u8fd8\u662f\u7edd\u5bf9\u8def\u5f84</p>"},{"location":"features/response/#xpath","title":"<code>xpath</code>","text":"<p>\u57fa\u4e8e <code>parsel</code> \u7684 <code>Selector</code> \u5bf9\u54cd\u5e94\u4f53\u89e3\u6790\uff0c\u8fd4\u56de\u6570\u636e\u683c\u5f0f\u4e3a\uff1a<code>SelectorList[Selector]</code></p>"},{"location":"features/response/#meta","title":"<code>meta</code>","text":"<p><code>property</code> \u7c7b\u578b\u7684\u65b9\u6cd5\u3002\u8fd4\u56de\u60a8\u5728\u8bf7\u6c42\u4e2d\u4f20\u5165\u7684\u81ea\u5b9a\u4e49\u6570\u636e</p>"},{"location":"features/response/#cookies","title":"<code>cookies</code>","text":"<p>\u8fd4\u56de\u5b57\u5178\u7c7b\u578b\u7684 <code>cookies</code>\uff0c\u5176\u4e2d</p> <ul> <li><code>key</code> \u4e3a <code>cookie</code> \u7684 <code>name</code></li> <li><code>value</code> \u4e3a <code>cookie</code> \u7684 <code>value</code></li> </ul>"},{"location":"features/response/#cookie_list","title":"<code>cookie_list</code>","text":"<p>\u8fd4\u56de\u5217\u8868\u7c7b\u578b\u7684 <code>cookies</code>\uff0c\u56e0\u67d0\u4e9b\u7f51\u7ad9\u8fd4\u56de\u7684 <code>ccokies</code> \u4e2d\u5b58\u5728\u591a\u4e2a <code>name</code> \u76f8\u540c\u7684\u503c\uff0c\u6240\u4ee5\u8fd4\u56de\u5217\u8868\u7c7b\u578b\uff0c\u65b9\u4fbf\u81ea\u5b9a\u4e49\u66f4\u7cbe\u7ec6\u7684\u5904\u7406\u903b\u8f91\u3002 \u793a\u4f8b\uff1a</p> <pre><code>[\n    {\n        \"key\": \"\",\n        \"value\": \"\",\n        \"domain\": \"\",\n        \"path\": \"\",\n        \"expires\": \"\",\n        \"secure\": \"\",\n        \"httponly\": \"\",\n    },\n    ...\n]\n</code></pre>"},{"location":"features/settings/","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e <code>project/settings.py</code>\uff0c\u4e0e <code>run.py</code> \u6216 <code>settings.py</code> \u540c\u7ea7\u3002 \u540c\u6837\u7684\uff0c\u4e5f\u53ef\u4ee5\u5728 <code>Spider</code> \u4e2d\u7684 <code>custom_settings</code> \u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff0c\u4f18\u5148\u7ea7\u9ad8\u4e8e <code>settings.py</code>\u3002</p> <pre><code>from maize import Spider\n\n\nclass CustomSpider(Spider):\n    custom_settings = {\n        # \u5e76\u53d1\u6570\n        'CONCURRENCY': 2,\n\n        # \u662f\u5426\u9a8c\u8bc1 SSL \u8bc1\u4e66\n        'VERIFY_SSL': False,\n\n        # \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\n        'REQUEST_TIMEOUT': 30,\n\n        # \u662f\u5426\u4f7f\u7528 session\n        'USE_SESSION': False,\n\n        # ...\n    }\n\n    # ...\n</code></pre> <p>\u9ed8\u8ba4\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code># \u5e76\u53d1\u6570\nCONCURRENCY = 1\n\n# \u662f\u5426\u9a8c\u8bc1 SSL \u8bc1\u4e66\nVERIFY_SSL = True\n\n# \u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\nREQUEST_TIMEOUT = 60\n\n# \u662f\u5426\u4f7f\u7528 session\n# \u6ce8\u610f\uff1a\u57fa\u4e8e httpx \u7684\u4e0b\u8f7d\u5668\uff08HTTPXDownloader\uff09\u4e0d\u652f\u6301 session\uff0c\u6240\u4ee5\u6b64\u9009\u9879\u65e0\u6548\nUSE_SESSION = True\n\n# \u4e0b\u8f7d\u5668\n# \u57fa\u4e8e aiohttp \u5c01\u88c5\u7684\u4e0b\u8f7d\u5668\uff1amaize.AioHttpDownloader\n# \u57fa\u4e8e httpx \u5c01\u88c5\u7684\u4e0b\u8f7d\u5668\uff1amaize.HTTPXDownloader\nDOWNLOADER = \"maize.AioHttpDownloader\"\n\n# \u65e5\u5fd7\u7ea7\u522b\uff0c\u4e0e logging \u65e5\u5fd7\u7ea7\u522b\u76f8\u540c\n# \u5982\u679c\u60a8\u4f7f\u7528\u81ea\u5b9a\u4e49\u65e5\u5fd7\u5904\u7406\u6a21\u5757\uff0c\u6b64\u9009\u9879\u65e0\u6548\uff0c\u8bf7\u60a8\u5728\u81ea\u5b9a\u4e49\u65e5\u5fd7\u5904\u7406\u6a21\u5757\u4e2d\u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\nLOG_LEVEL = \"INFO\"\n\n# # \u65e5\u5fd7 handler\n# # \u5982\u4e0d\u60f3\u4f7f\u7528\u9ed8\u8ba4\u7684 logging \u6a21\u5757\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u65e5\u5fd7\u5904\u7406\u6a21\u5757\n# LOGGER_HANDLER = \"\"\n\n# \u6700\u5927\u91cd\u8bd5\u6b21\u6570\nMAX_RETRY_COUNT = 0\n\n# item\u5728\u5185\u5b58\u961f\u5217\u4e2d\u6700\u5927\u7f13\u5b58\u6570\u91cf\nITEM_MAX_CACHE_COUNT = 5000\n\n# item\u6bcf\u6279\u5165\u5e93\u7684\u6700\u5927\u6570\u91cf\nITEM_HANDLE_BATCH_MAX_SIZE = 1000\n\n# item\u5165\u5e93\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\nITEM_HANDLE_INTERVAL = 2\n\n# # \u6570\u636e\u7ba1\u9053\uff0c\u652f\u6301\u591a\u4e2a\u6570\u636e\u7ba1\u9053\n# # maize.BasePipeline: \u9ed8\u8ba4\u6570\u636e\u7ba1\u9053\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\n# # maize.MysqlPipeline: \u96c6\u6210 aiomysql \u7684\u6570\u636e\u7ba1\u9053\uff0c\u81ea\u52a8\u5165\u5e93 mysql \u6570\u636e\u5e93\n# ITEM_PIPELINES = [\"maize.BasePipeline\"]\n\n# # \u96a7\u9053\u4ee3\u7406\uff0c\u793a\u4f8b\uff1axxx.xxx:2132\u3002\u6ce8\u610f\uff1a\u4e0d\u5305\u542b http:// \u6216 https://\n# PROXY_TUNNEL = \"\"\n#\n# # \u96a7\u9053\u4ee3\u7406\u7528\u6237\u540d\n# PROXY_TUNNEL_USERNAME = \"\"\n#\n# # \u96a7\u9053\u4ee3\u7406\u5bc6\u7801\n# PROXY_TUNNEL_PASSWORD = \"\"\n\n# # mysql\u6570\u636e\u5e93\u914d\u7f6e\n# MYSQL_HOST = \"localhost\"\n# MYSQL_PORT = 3306\n# MYSQL_DB = \"\"\n# MYSQL_USER = \"\"\n# MYSQL_PASSWORD = \"\"\n</code></pre>"},{"location":"features/spider/","title":"Spider \u8fdb\u9636","text":""},{"location":"features/spider/#_1","title":"\u9879\u76ee\u7ed3\u6784","text":"<p>\u4e00\u4e2a\u5b8c\u6574\u7684\u722c\u866b\u9879\u76ee\uff0c\u4e0d\u53ef\u80fd\u662f\u5355\u6587\u4ef6\u722c\u866b\uff0c\u9700\u8981\u5c06\u4e0d\u540c\u529f\u80fd\u6a21\u5757\u62c6\u5206\u51fa\u6765\uff0c\u5404\u53f8\u5176\u804c\uff0c\u4fbf\u4e8e\u5f00\u53d1\u548c\u7ef4\u62a4\u3002 \u63a8\u8350\u4f7f\u7528\u7684\u9879\u76ee\u7ed3\u6784</p> <pre><code>\u251c\u2500example_spider\n\u2502 \u2514\u2500spiders        # \u5b58\u653e\u6240\u6709\u722c\u866b\n\u2502   \u251c\u2500spiders_1.py\n\u2502   \u251c\u2500spiders_2.py\n\u2502   \u2514\u2500...\n\u251c\u2500items.py         # \u5b9a\u4e49\u722c\u866b\u89e3\u6790\u540e\u7684 Item\n\u251c\u2500settings.py      # \u9879\u76ee\u914d\u7f6e\u6587\u4ef6\n\u2514\u2500run.py           # \u542f\u52a8\u5165\u53e3\uff0cmain.py \u4e5f\u53ef\u4ee5\n</code></pre> <p>\u4e0b\u9762\u4ee5\u767e\u5ea6\u722c\u866b\u4e3a\u4f8b\uff0c\u5199\u4e00\u4e2a\u5b8c\u6574\u7684\u722c\u866b\u9879\u76ee\u3002\u76ee\u5f55\u7ed3\u6784\uff1a</p> <pre><code>\u251c\u2500baidu_spider\n\u2502 \u2514\u2500spiders        # \u5b58\u653e\u6240\u6709\u722c\u866b\n\u2502   \u2514\u2500baidu_spider.py\n\u251c\u2500items.py         # \u5b9a\u4e49\u722c\u866b\u89e3\u6790\u540e\u7684 Item\n\u251c\u2500settings.py      # \u9879\u76ee\u914d\u7f6e\u6587\u4ef6\n\u2514\u2500run.py           # \u542f\u52a8\u5165\u53e3\uff0cmain.py \u4e5f\u53ef\u4ee5\n</code></pre> baidu_spider.pyitems.pysettings.pyrun.py <pre><code>from maize import Request\nfrom maize import Spider\nfrom baidu_spider.items import BaiduItem\n\n\nclass BaiduSpider(Spider):\n    start_urls = [\"http://www.baidu.com\", \"http://www.baidu.com\"]\n\n    async def parse(self, response):\n        print(f\"parse: {response}\")\n        for i in range(1):\n            url = \"http://www.baidu.com\"\n            yield Request(url=url, callback=self.parse_page)\n\n    async def parse_page(self, response):\n        print(f\"parse_page: {response}\")\n        for i in range(1):\n            url = \"http://www.baidu.com\"\n            yield Request(url=url, callback=self.parse_detail)\n\n    async def parse_detail(self, response):\n        # print(response.text)\n        print(f\"parse_detail: {response}\")\n        item = BaiduItem()\n        item[\"url\"] = \"https://www.baidu.com\"\n        item[\"title\"] = \"\u767e\u5ea6\u4e00\u4e0b\"\n        yield item\n</code></pre> <pre><code>from maize import Field\nfrom maize import Item\n\n\nclass BaiduItem(Item):\n    url = Field()\n    title = Field()\n</code></pre> <pre><code>PROJECT_NAME = \"baidu_spider\"\nCONCURRENCY = 1\nLOG_LEVEL = \"DEBUG\"\n</code></pre> <pre><code>import asyncio\n\nfrom maize import CrawlerProcess\nfrom maize.utils import get_settings\nfrom baidu_spider.spiders.baidu_spider import BaiduSpider\n\n\nasync def run():\n    settings = get_settings(\"settings\")\n    process = CrawlerProcess(settings)\n    await process.crawl(BaiduSpider)\n    await process.start()\n\n\nif __name__ == '__main__':\n    asyncio.run(run())\n</code></pre>"},{"location":"use/before_use/","title":"\u4f7f\u7528\u524d\u5fc5\u8bfb","text":"<p>\u63a8\u8350\u4f7f\u7528\u7684\u9879\u76ee\u7ed3\u6784</p> <pre><code>\u251c\u2500example_spider\n\u2502 \u2514\u2500spiders        # \u5b58\u653e\u6240\u6709\u722c\u866b\n\u2502   \u251c\u2500spiders_1.py\n\u2502   \u251c\u2500spiders_2.py\n\u2502   \u2514\u2500...\n\u251c\u2500items.py         # \u5b9a\u4e49\u722c\u866b\u89e3\u6790\u540e\u7684 Item\n\u251c\u2500settings.py      # \u9879\u76ee\u914d\u7f6e\u6587\u4ef6\n\u2514\u2500run.py           # \u542f\u52a8\u5165\u53e3\uff0cmain.py \u4e5f\u53ef\u4ee5\n</code></pre>"}]}